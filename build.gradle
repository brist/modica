defaultTasks 'clean', 'test', 'integrationTest','assemble'

subprojects {subProject ->
    apply plugin: 'java'
    apply plugin: 'eclipse'
    compileJava.options.fork([memoryMaximumSize: '1024m'])
    jar.baseName = "afp-parse_$subProject.name"

    buildDir = "build"
    sourceCompatibility = 1.6
    targetCompatibility = 1.6

    group = 'org.afpparser'

    repositories {
        mavenCentral()
    }

    configurations {
        jacoco
    }

    dependencies {
	testCompile group: "junit", name: "junit", version: "4.8.1"

	jacoco group: "org.jacoco", name: "org.jacoco.agent", version: "0.5.5.201112152213", classifier: "runtime"
	jacoco group: "org.jacoco", name: "org.jacoco.report", version: "0.5.5.201112152213"
    }

    classes.doLast {
        copy {
            into 'build/libs/lib'
            from configurations.runtime
        }
    }

    test {
        jvmArgs "-javaagent:" + configurations.jacoco.asPath + "=destfile=" + buildDir + "/jacoco.exec,includes=org.afpparser.*"
    }
}
